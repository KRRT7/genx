<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Frequently Asked Questions &#8212; GenX 2.4.9 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootswatch-3.3.6/flatly/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.4.9',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="shortcut icon" href="_static/genx.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Development documentation" href="development.html" />
    <link rel="prev" title="Using GenX from the command line (with mpi)" href="tutorials/mpi.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          GenX</a>
        <span class="navbar-text navbar-version pull-left"><b>2.4</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Content <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#windows">Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#mac-os-x">Mac OS-X</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#from-source">From source</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#reflectivity">Reflectivity</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#surface-x-ray-diffraction">Surface x-ray diffraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorials.html#other-tutorials">Other tutorials</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fitting">Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reflectivity">Reflectivity</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Development documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="development/data.html">Data classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/write_data_loader.html">How to write a Data Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/write_fom.html">Writing a FOM function</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/packaging.html">How to package GenX</a></li>
<li class="toctree-l2"><a class="reference internal" href="development/mag_refl.html">A model for magnetic reflectivity</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Frequently Asked Questions</a><ul>
<li><a class="reference internal" href="#general">General</a><ul>
<li><a class="reference internal" href="#how-should-i-cite-genx">How should I cite GenX?</a></li>
<li><a class="reference internal" href="#i-can-not-run-genx-on-a-64-bit-mac">I can not run GenX on a 64-bit Mac</a></li>
<li><a class="reference internal" href="#issue-with-editing-the-grid-on-mac">Issue with editing the grid on Mac</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fitting">Fitting</a><ul>
<li><a class="reference internal" href="#can-t-fit-and-fom-shows-inf-or-nan">Can&#8217;t fit and FOM shows inf or Nan</a></li>
<li><a class="reference internal" href="#an-error-message-appears-when-i-start-fitting-or-the-fom-plot-and-the-fom-message-in-the-toolbar-differ">An error message appears when I start fitting or the FOM plot and the FOM message in the toolbar differ</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reflectivity">Reflectivity</a><ul>
<li><a class="reference internal" href="#how-do-i-add-an-2theta-offset">How do I add an 2Theta offset</a></li>
<li><a class="reference internal" href="#what-about-different-scattering-length-databases">What about different scattering length databases?</a></li>
<li><a class="reference internal" href="#what-happens-if-i-fit-the-scattering-length">What happens if I fit the scattering length?</a></li>
<li><a class="reference internal" href="#could-you-explain-how-the-density-is-defined-works-with-an-example">Could you explain how the density is defined/works with an example?</a></li>
<li><a class="reference internal" href="#how-do-i-transform-from-g-cm3-to-formula-unit-a3">How do I transform from g/cm<sup>3</sup> to formula unit/Å<sup>3</sup> ?</a></li>
<li><a class="reference internal" href="#how-do-i-get-the-scattering-length-of-an-isotope">How do I get the scattering length of an isotope?</a></li>
<li><a class="reference internal" href="#error-when-simulating-spin-flip-reflectivity">Error when simulating spin flip reflectivity</a></li>
<li><a class="reference internal" href="#is-it-possible-to-automatically-normalise-the-fitted-function-to-the-data">Is it possible to automatically normalise the fitted function to the data?</a></li>
<li><a class="reference internal" href="#i-want-to-use-different-instruments-instances-to-fit-data-sets-collected-of-different-instruments">I want to use different instruments instances to fit data sets collected of different instruments</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="frequently-asked-questions">
<span id="faq"></span><h1>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="general">
<h2>General<a class="headerlink" href="#general" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-should-i-cite-genx">
<h3>How should I cite GenX?<a class="headerlink" href="#how-should-i-cite-genx" title="Permalink to this headline">¶</a></h3>
<p>Give a reference to the paper describing GenX:
M. Björck and G. Andersson J. Appl. Cryst. 40, 1174 (2007)
And if you want to give a link to the homepage: &lt;<a class="reference external" href="http://genx.sf.net">http://genx.sf.net</a>&gt;</p>
</div>
<div class="section" id="i-can-not-run-genx-on-a-64-bit-mac">
<h3>I can not run GenX on a 64-bit Mac<a class="headerlink" href="#i-can-not-run-genx-on-a-64-bit-mac" title="Permalink to this headline">¶</a></h3>
<p>Some distributions (EPD) does not provide wxPython compiled for 64-bit machines. You then have to tell python
to use the 32-bit version instead by setting an environment variable.</p>
<blockquote>
<div>export PYTHON_PREFER_32_BIT=yes</div></blockquote>
<p>If you want this to have permanent effect you can edit your <code class="docutils literal"><span class="pre">/etc/bashrc</span></code> file alt. edit your <code class="docutils literal"><span class="pre">.bashrc</span></code> file
in the home directory. If you do not have a <code class="docutils literal"><span class="pre">.bashrc</span></code> file in home you can copy your <code class="docutils literal"><span class="pre">/etc/bashrc</span></code> file to
home and then edit it.</p>
</div>
<div class="section" id="issue-with-editing-the-grid-on-mac">
<h3>Issue with editing the grid on Mac<a class="headerlink" href="#issue-with-editing-the-grid-on-mac" title="Permalink to this headline">¶</a></h3>
<p>If you use a Swedish decimal comma then there are difficulties editing the grid. Swap to a decimal point instead in
settings.</p>
</div>
</div>
<div class="section" id="fitting">
<h2>Fitting<a class="headerlink" href="#fitting" title="Permalink to this headline">¶</a></h2>
<div class="section" id="can-t-fit-and-fom-shows-inf-or-nan">
<h3>Can&#8217;t fit and FOM shows inf or Nan<a class="headerlink" href="#can-t-fit-and-fom-shows-inf-or-nan" title="Permalink to this headline">¶</a></h3>
<p>If you are using a figure of merit that uses log, for example the log fom (figure of merit)
which is the <strong>standard</strong>, you probably have a negative or zero data point. Remove the data point or change
the fom to a more suitable one. The same can happen if you fit with a fom that uses errors as weight and you
have an error of zero somewhere.</p>
</div>
<div class="section" id="an-error-message-appears-when-i-start-fitting-or-the-fom-plot-and-the-fom-message-in-the-toolbar-differ">
<h3>An error message appears when I start fitting or the FOM plot and the FOM message in the toolbar differ<a class="headerlink" href="#an-error-message-appears-when-i-start-fitting-or-the-fom-plot-and-the-fom-message-in-the-toolbar-differ" title="Permalink to this headline">¶</a></h3>
<p>The following message appears: ERROR The disagreement between two subsequent evaluations is larger
than [Number(1e-10)]. Check the model for circular assignments. In older versions this showed up as different
FOM&#8217;s in the toolbar and the FOM plot.</p>
<p>Then you have somehow made a logical error in your model script. This means that the value of the FOM depends
on the <strong>history</strong> of the parameters. This is because when fitting the fom is evaluated for the entire population and
then at the end of each generation the program will do one additional simulation to calculate the data shown in the
gui. The plotted fom shown in the FOM folder comes from the population but the FOM that comes from the simulation
is shown in the tool bar! This could occur, for example, if you set a value of a variable that you think that you
will fit but then leave unchanged. For example (<code class="docutils literal"><span class="pre">cp</span></code> is a custom parameter)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Sim</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
   <span class="o">....</span>
   <span class="o">....</span>
   <span class="n">cp</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">test</span> <span class="o">-</span> <span class="mf">1.0</span>
   <span class="o">...</span>
   <span class="o">...</span>
   <span class="c1"># Simulate something that uses cp.test</span>
</pre></div>
</div>
<p>This will work all fine if you simulate your model it will behave as expected, even if you just evaluate
it. However if you fit it and leave it as a non-fitable parameter or remove it from the grid strange things will
happen!. For each evaluation the parameter <cite>cp.test</cite> will be decreased by 1.0 since it will not be given a value
from the fitting algorithm anymore. So write the <code class="docutils literal"><span class="pre">Sim</span></code> function like this instead:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Sim</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
   <span class="o">....</span>
   <span class="o">....</span>
   <span class="n">new_test</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">test</span> <span class="o">-</span> <span class="mf">1.0</span>
   <span class="o">...</span>
   <span class="o">...</span>
   <span class="c1"># Simulate something that uses new_test</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">And remember <strong>never ever</strong> set a parameter so you create a circular behavior as shown above.</p>
</div>
<p>Note that this could also occur in a perfectly right model if the underlying computer/code has a too low
precision compared to the threshold value. You can then change the threshold value in <code class="docutils literal"><span class="pre">genx.conf</span></code>, section <code class="docutils literal"><span class="pre">solver</span></code>
parameter <code class="docutils literal"><span class="pre">allowed</span> <span class="pre">fom</span> <span class="pre">discrepancy</span></code> to a larger value.</p>
</div>
</div>
<div class="section" id="reflectivity">
<h2>Reflectivity<a class="headerlink" href="#reflectivity" title="Permalink to this headline">¶</a></h2>
<div class="section" id="how-do-i-add-an-2theta-offset">
<h3>How do I add an 2Theta offset<a class="headerlink" href="#how-do-i-add-an-2theta-offset" title="Permalink to this headline">¶</a></h3>
<p>Sometimes during fitting one needs to add a small 2Theta offset due to misalignment. To do this you start by
adding a custom variable in the reflectivity plugin. This is the blue nut button in the simulation tab. Lets call
the parameter <code class="docutils literal"><span class="pre">TthOff</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This way is deprecated since version 2.2.0 as it can now been done through the gui with the reflectivity plugin
in the simulation tab. That is the <cite>Sim</cite> function does not have to be changed manually.</p>
</div>
<p>Then the <code class="docutils literal"><span class="pre">Sim</span></code> function have to be changed to something like (located in the Script tab):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Sim</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Things that should be inserted begin:</span>
    <span class="n">tmp0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="mf">1.0</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">tmp0</span> <span class="o">+</span> <span class="n">cp</span><span class="o">.</span><span class="n">TthOff</span>
    <span class="c1"># End insertion</span>

    <span class="c1"># BEGIN Dataset 0 DO NOT CHANGE</span>
    <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">SimSpecular</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
    <span class="c1"># END Dataset 0</span>
    <span class="c1"># Things that should be inserted begin:</span>
    <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">tmp0</span>
    <span class="c1"># End insertion</span>
</pre></div>
</div>
<p>Note that it is important to place the code outside the part marked with <cite>DO NOT CHANGE</cite>. The offset variable
has been implemented in the spec_nx model.</p>
</div>
<div class="section" id="what-about-different-scattering-length-databases">
<h3>What about different scattering length databases?<a class="headerlink" href="#what-about-different-scattering-length-databases" title="Permalink to this headline">¶</a></h3>
<p>GenX has currently three different scattering length databases fp, fw, bc and f. The databases beginning with f
relates to x-ray scattering. These are based on the Henke tables and can be found at the
<a class="reference external" href="http://www.cxro.lbl.gov/">CXRO&#8217;s homepage</a>. The difference between fp and fw is the scaling fp has
units of electrons (or rather Thompson scattering lengths), this means that any densities in inserted in a
layer using fp has to be in atoms/AA3. If one uses fw the scattering length of an atom has been scaled by its
atomic weight consequently the density can be inserted in units of g/cm3. Note that the composition has to be given
in weight percent of the different constituents an a compound. Both fp and fw are the scattering factors at <span class="math">\(Q=0\)</span>
(forward scattering) if one wants to use the Q varying atomic scattering factor the f library should be used which
returns f as a function of Q. The data is collected from ESRF&#8217;s DABAX library. bc is the neutron
coherent scattering length used for neutron reflectivity calculations. It has a corresponding
bw which works as for fw. Note that bc is given in fm (fermi meters).</p>
</div>
<div class="section" id="what-happens-if-i-fit-the-scattering-length">
<h3>What happens if I fit the scattering length?<a class="headerlink" href="#what-happens-if-i-fit-the-scattering-length" title="Permalink to this headline">¶</a></h3>
<p>As GenX only can fit real numbers the complex part of the scattering len    gth will be ignored.
Thus the absorption is put to zero. If you want to fit both parameters you have to make a custom variable
for at least the complex part. Note that in newer versions &gt; 2.0b6.2 the real and imaginary part of the
scattering lengths can be fitted separately.</p>
</div>
<div class="section" id="could-you-explain-how-the-density-is-defined-works-with-an-example">
<h3>Could you explain how the density is defined/works with an example?<a class="headerlink" href="#could-you-explain-how-the-density-is-defined-works-with-an-example" title="Permalink to this headline">¶</a></h3>
<p>The key thing to understand is that the calculations use the scattering length density, the scattering length
multiplied with the density. Thus, how you define and scale your scattering length must be taken into account
when you define the density.</p>
<p>Example 1: Pure Fe. You define the scattering length as <code class="docutils literal"><span class="pre">fp.Fe</span></code> Then the density becomes (1 formula unit = 1 Fe atom,
Fe bcc 2 atoms/unit cell, a = 2.866): <code class="docutils literal"><span class="pre">2/2.866**3</span></code> You could also define the scattering length as one
unit cell of Fe <code class="docutils literal"><span class="pre">2*fp.Fe</span></code> Then the density becomes: <code class="docutils literal"><span class="pre">1/2.866**3</span></code></p>
<p>Example 2: SrTiO3. You define the scattering length as <code class="docutils literal"><span class="pre">fp.Sr</span> <span class="pre">+</span> <span class="pre">fp.Ti</span> <span class="pre">+</span> <span class="pre">fp.O*3</span></code> Then the density becomes
(1 formula unit = 1 unitcell of SrTiO:sub:<cite>3</cite>, a = 3.9045): <code class="docutils literal"><span class="pre">1/3.9045**3</span></code></p>
</div>
<div class="section" id="how-do-i-transform-from-g-cm3-to-formula-unit-a3">
<h3>How do I transform from g/cm<sup>3</sup> to formula unit/Å<sup>3</sup> ?<a class="headerlink" href="#how-do-i-transform-from-g-cm3-to-formula-unit-a3" title="Permalink to this headline">¶</a></h3>
<p>I have the density of my material in g/cm<sup>3</sup> or kg/m<sup>3</sup>, how do I use it in GenX? There are two ways:
The first involves only to work with compositions in weight percent and use the fw scattering factors which are
scattering lengths per weight and use densities in g/cm<sup>3</sup>. The other is recalculate the density in g/cm<sup>3</sup>
to formula units per Å<sup>3</sup>. This goes as follows:</p>
<p>The relative atomic mass, u, is defined as <span class="math">\(1 u = 1.66054\times 10-27\, \mathrm{kg}\)</span>. <span class="math">\(1 A = 10^-10 m\)</span>.
This means that</p>
<div class="math">
\[\rho \mathrm{[kg/m^3]} = 1.66054 \times 10^3 \times (\rho \mathrm{[u/A^3]}).\]</div>
<p>Thus, the density (scatterers per unit volume (density in GenX)) becomes:</p>
<div class="math">
\[\mathrm{dens} = (\rho \mathrm{[kg/m^3]})/(1.66054 \times 10^3 \times uscatt),\]</div>
<p>where</p>
<div class="math">
\[uscatt = \sum_i u_i \times x_i\]</div>
<p>and the scattering length is written as</p>
<div class="math">
\[f = \sum_i f_i \times x_i.\]</div>
<p>Let us use SrTiO3 as example, it has a density <span class="math">\(\rho = 5.12 g/cm^3\)</span>. The scattering length is
defined as: <code class="docutils literal"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">1*fp.Sr</span> <span class="pre">+</span> <span class="pre">1*fp.Ti</span> <span class="pre">+</span> <span class="pre">3*fp.O</span></code>. The weight of one &#8220;formula unit&#8221; becomes
<span class="math">\(uscatt = 1 \times 87.62 + 1 \times 47.87 + 3 \times 16.00 = 183.24\)</span>.
The density becomes: <span class="math">\(dens = \frac{5.12 \times 10^3}{(1.66054 \times 10^3 \times 183.24} = 0.017\)</span></p>
</div>
<div class="section" id="how-do-i-get-the-scattering-length-of-an-isotope">
<h3>How do I get the scattering length of an isotope?<a class="headerlink" href="#how-do-i-get-the-scattering-length-of-an-isotope" title="Permalink to this headline">¶</a></h3>
<p>To access the scattering length of isotopes use an <code class="docutils literal"><span class="pre">i</span></code> in front of the name. For example: For 57Fe the
scattering length expression would be <code class="docutils literal"><span class="pre">bc.i57Fe</span></code>. For Deuterium (2H) the expression would be <code class="docutils literal"><span class="pre">bc.2H</span></code>.</p>
</div>
<div class="section" id="error-when-simulating-spin-flip-reflectivity">
<h3>Error when simulating spin flip reflectivity<a class="headerlink" href="#error-when-simulating-spin-flip-reflectivity" title="Permalink to this headline">¶</a></h3>
<p>I get an error when the program tries to calculate neutron spin flip reflectivity. The error is following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">It</span> <span class="n">was</span> <span class="ow">not</span> <span class="n">possible</span> <span class="n">to</span> <span class="n">evaluate</span> <span class="n">the</span> <span class="n">model</span> <span class="n">script</span><span class="o">.</span>

<span class="n">Check</span> <span class="n">the</span> <span class="n">Sim</span> <span class="n">function</span><span class="o">.</span>
<span class="o">...</span> <span class="n">LOTS</span> <span class="n">OF</span> <span class="n">TEXT</span> <span class="o">...</span>
<span class="n">LinAlgError</span><span class="p">:</span> <span class="n">Singular</span> <span class="n">matrix</span>
</pre></div>
</div>
<p>This is because there is a singular matrix calculation for an incident angle of 0 or Q = 0. Try to
remove the first data points and it should work.</p>
</div>
<div class="section" id="is-it-possible-to-automatically-normalise-the-fitted-function-to-the-data">
<h3>Is it possible to automatically normalise the fitted function to the data?<a class="headerlink" href="#is-it-possible-to-automatically-normalise-the-fitted-function-to-the-data" title="Permalink to this headline">¶</a></h3>
<p>Yes. Add the parameter I0 from the Instrument sub-menu to scale the fit; fitting this parameter will
autoscale the fit to the data.</p>
</div>
<div class="section" id="i-want-to-use-different-instruments-instances-to-fit-data-sets-collected-of-different-instruments">
<h3>I want to use different instruments instances to fit data sets collected of different instruments<a class="headerlink" href="#i-want-to-use-different-instruments-instances-to-fit-data-sets-collected-of-different-instruments" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This functionality has been included in the reflectivity plugin since version 2.2.0. Multiple instrument can defined
in the instrument definition dialog. By double clicking on the simulation function definition in the simulation tab
the instrument to use for that particular simulation can be chosen.</p>
</div>
<p>Assuming that you want to use the reflectivity plugin the following hack has to be done to the script.
1. Define your new instruments manually in the code. This has to be done outside the the BEGIN and END sections of the instrument definition
2. Inside the Sim function - store the the original inst parameters
3. Just before the dataset that should use a different instrument redefine the instrument and change the wavelength of the scattering length table, if needed.
4. Copy over the original settings to the inst object again.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">models.spec_nx</span> <span class="k">as</span> <span class="nn">model</span>
<span class="kn">from</span> <span class="nn">models.utils</span> <span class="k">import</span> <span class="n">UserVars</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="p">,</span> <span class="n">bc</span><span class="p">,</span> <span class="n">bw</span>

<span class="c1"># BEGIN Instrument DO NOT CHANGE</span>
<span class="n">inst</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">footype</span> <span class="o">=</span> <span class="s1">&#39;gauss beam&#39;</span><span class="p">,</span><span class="n">probe</span> <span class="o">=</span> <span class="s1">&#39;neutron&#39;</span><span class="p">,</span><span class="n">beamw</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span><span class="n">resintrange</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">tthoff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">pol</span> <span class="o">=</span> <span class="s1">&#39;uu&#39;</span><span class="p">,</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">4.4</span><span class="p">,</span><span class="n">respoints</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="n">Ibkg</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">I0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">samplelen</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span><span class="n">restype</span> <span class="o">=</span> <span class="s1">&#39;full conv and varying res.&#39;</span><span class="p">,</span><span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;tth&#39;</span><span class="p">,</span><span class="n">res</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">,</span><span class="n">incangle</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">set_wavelength</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
<span class="c1">#Compability issues for pre-fw created gx files</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fw</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fw</span><span class="o">.</span><span class="n">set_wavelength</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
<span class="c1"># END Instrument</span>
<span class="c1"># Step 1. Defining instruments</span>
<span class="n">xraydiff</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Instrument</span><span class="p">(</span><span class="n">footype</span> <span class="o">=</span> <span class="s1">&#39;gauss beam&#39;</span><span class="p">,</span><span class="n">probe</span> <span class="o">=</span> <span class="s1">&#39;x-ray&#39;</span><span class="p">,</span><span class="n">beamw</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span><span class="n">resintrange</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">tthoff</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mf">1.54</span><span class="p">,</span><span class="n">respoints</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="n">Ibkg</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span><span class="n">I0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="n">samplelen</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">,</span><span class="n">restype</span> <span class="o">=</span> <span class="s1">&#39;full conv and varying res.&#39;</span><span class="p">,</span><span class="n">coords</span> <span class="o">=</span> <span class="s1">&#39;tth&#39;</span><span class="p">,</span><span class="n">res</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">set_wavelength</span><span class="p">(</span><span class="n">xraydiff</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>

<span class="c1"># BEGIN Sample DO NOT CHANGE</span>
<span class="n">Amb</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-20</span><span class="o">+</span><span class="mf">1e-20j</span><span class="p">),</span> <span class="n">dens</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">magn_ang</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">xs_ai</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">magn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">SiO</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">Si</span><span class="o">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">bc</span><span class="o">.</span><span class="n">O</span><span class="o">.</span><span class="n">real</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mi">1205</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">Si</span> <span class="o">+</span> <span class="n">fp</span><span class="o">.</span><span class="n">O</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="n">dens</span> <span class="o">=</span> <span class="mf">0.026</span><span class="p">,</span> <span class="n">magn_ang</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xs_ai</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">magn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>
<span class="n">Sub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Layer</span><span class="p">(</span><span class="n">b</span> <span class="o">=</span> <span class="n">bc</span><span class="o">.</span><span class="n">Si</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">Si</span><span class="p">,</span> <span class="n">dens</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="mf">5.443</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">magn_ang</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">xs_ai</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">magn</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span>

<span class="n">surf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Stack</span><span class="p">(</span><span class="n">Layers</span><span class="o">=</span><span class="p">[</span><span class="n">SiO</span><span class="p">],</span> <span class="n">Repetitions</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Sample</span><span class="p">(</span><span class="n">Stacks</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf</span><span class="p">],</span> <span class="n">Ambient</span> <span class="o">=</span> <span class="n">Amb</span><span class="p">,</span> <span class="n">Substrate</span> <span class="o">=</span> <span class="n">Sub</span><span class="p">)</span>
<span class="c1"># END Sample</span>

<span class="c1"># BEGIN Parameters DO NOT CHANGE</span>
<span class="n">cp</span> <span class="o">=</span> <span class="n">UserVars</span><span class="p">()</span>
<span class="c1"># END Parameters</span>


<span class="k">def</span> <span class="nf">Sim</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Step 2. store the original inst parameters</span>
    <span class="n">default_pars</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">_todict</span><span class="p">()</span>
    <span class="n">I</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># You only need the line below if you work with two different x-ray instruments.</span>
    <span class="c1">#fp.set_wavelength(inst.wavelength)</span>
    <span class="c1"># BEGIN Dataset 0 DO NOT CHANGE</span>
    <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">SimSpecular</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
    <span class="c1"># END Dataset 0</span>
    <span class="c1"># Step 3. Copying all parameters from instrument xraydiff to inst</span>
    <span class="n">inst</span><span class="o">.</span><span class="n">_fromdict</span><span class="p">(</span><span class="n">xraydiff</span><span class="o">.</span><span class="n">_todict</span><span class="p">())</span>
    <span class="c1"># You only need the line below if you work with two different x-ray instruments.</span>
    <span class="n">fp</span><span class="o">.</span><span class="n">set_wavelength</span><span class="p">(</span><span class="n">xraydiff</span><span class="o">.</span><span class="n">wavelength</span><span class="p">)</span>
    <span class="c1"># BEGIN Dataset 1 DO NOT CHANGE</span>
    <span class="n">I</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">SimSpecular</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">inst</span><span class="p">))</span>
    <span class="c1"># END Dataset 1</span>
    <span class="c1"># Step 4. Copying all instrument parameter from the original inst to inst.</span>
    <span class="n">inst</span><span class="o">.</span><span class="n">_fromdict</span><span class="p">(</span><span class="n">default_pars</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">I</span>
</pre></div>
</div>
<p>Hopefully, this will become automated in the future so that it can be done from within the plugin.</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/faq.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2017, Matts Björck.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>